### I created this for secreted_surfaceexposed proteins in Bb. total 99*3 predictions
### nano multimer_array.slurm
### submit - sbatch multimer_array.slurm

#!/bin/bash
#SBATCH --job-name=af_multimer_array
#SBATCH --output=logs/afm_%A_%a.out
#SBATCH --error=logs/afm_%A_%a.err
#SBATCH --mail-type=END,FAIL
#SBATCH --mail-user=mnima1@jh.edu
#SBATCH --cpus-per-task=8
#SBATCH --mem=64G
#SBATCH --gres=gpu:1
#SBATCH --partition=gpu
#SBATCH --time=72:00:00
#SBATCH --array=0-290

module load alphafold/2.3.1

FASTA=$(sed -n "$((SLURM_ARRAY_TASK_ID+1))p" fasta_list.txt)
NAME=$(basename "$FASTA" .fasta)
SIGNAL=$(echo "$FASTA" | cut -d'/' -f1)   # Gets EGF, TGFa, or BTC from the path

OUT_DIR="/fastscratch/myscratch/mnima/alphafold/secreted_surfaceexposed/${SIGNAL}_output/${NAME}_output"
DATA_DIR="/legacy/alphafold/data"
DATE="2020-05-14"

mkdir -p "$OUT_DIR"

run_alphafold.sh \
    -d "$DATA_DIR" \
    -o "$OUT_DIR" \
    -f "$FASTA" \
    -t "$DATE" \
    -n 8 \
    -m multimer
